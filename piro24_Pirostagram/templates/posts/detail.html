{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="container">
    <div class="post-card">
    
        <!-- ì‘ì„±ì ì´ë¯¸ì§€, ì´ë¦„ -->
        <div class="post-header">
            <img class="post-profile-image"
                src="{% if post.author.profile.image %}{{ post.author.profile.image.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}"
                alt="profile"
            >
            <a href="{% url 'users:profile' post.author.username %}">
                {{ post.author.username }}
            </a>
        </div>
    
        <!-- ì´ë¯¸ì§€ -->
        {% if post.image %}
            <div class="post-image">
                <img src="{{ post.image.url }}" alt="post image">
            </div>
        {% endif %}
    
        <!-- ë‚´ìš© -->
        {% if post.content %}
            <div class="post-content">
                {{ post.content }}
            </div>
        {% endif %}
        
        <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
        <form action="{% url 'posts:like' post.pk %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="like-btn">
                {% if is_liked %}
                    â¤ï¸
                {% else %}
                    ğŸ¤
                {% endif %}
                {{ post.likes.count }}
            </button>
        </form>

        <!-- ë‚ ì§œ -->
        <div class="post-date">
            {{ post.created_at|date:"Y.m.d H:i" }}
        </div>
    
        <!-- ì‘ì„±ìë§Œ ìˆ˜ì •/ì‚­ì œ -->
        {% if post.author == request.user %}
        <div class="post-actions">
            <a href="{% url 'posts:update' post.pk %}" class="post-update">ìˆ˜ì •</a>
    
            <form action="{% url 'posts:delete' post.pk %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="post-delete">ì‚­ì œ</button>
            </form>
        </div>
        {% endif %}
    
        <hr>
    
        <!-- ëŒ“ê¸€ ì‘ì„± -->
        <form class="comment-form"
          action="{% url 'posts:comment_create' post.pk %}" method="POST">
            {% csrf_token %}
            {{ comment_form.content }}
            <button type="submit">ê²Œì‹œ</button>
        </form>
    
        <!-- ëŒ“ê¸€ ëª©ë¡ -->
        <div class="comment-count">
            ëŒ“ê¸€ {{ post.comments.count }}ê°œ
        </div>
        <div class="comment-list">
            {% for comment in comments %}
                <div class="comment">
                    <strong>{{ comment.author.username }}</strong>
                    {% if editing_comment and editing_comment.pk == comment.pk %}
                        <!-- ìˆ˜ì • ì¤‘ -->
                        <form action="{% url 'posts:comment_update' post.pk comment.pk %}" method="POST">
                            {% csrf_token %}
                            {{ comment_form.content }}
                            <button type="submit">ìˆ˜ì •</button>
                            <a href="{% url 'posts:detail' post.pk %}">ì·¨ì†Œ</a>
                        </form>
                    {% else %}
                        {{ comment.content }}
    
                        {% if comment.author == request.user %}
                            <a href="{% url 'posts:comment_update' post.pk comment.pk %}" class="comment-update">ìˆ˜ì •</a>
                            <form action="{% url 'posts:comment_delete' post.pk comment.pk %}"
                                method="POST" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="comment-delete">ì‚­ì œ</button>
                            </form>
                        {% endif %}
                    {% endif %}
                </div>
            {% empty %}
                <p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}
