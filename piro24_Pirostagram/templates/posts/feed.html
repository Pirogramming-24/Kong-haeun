{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="feed">
    <!-- ìŠ¤í† ë¦¬ ë°” -->
    <div class="story-bar">
        <a href="{% url 'posts:story_create' %}" class="story-add">+ ìŠ¤í† ë¦¬</a>

        {% for story in stories %}
            <a href="{% url 'posts:story_detail' story.pk %}" class="story-item">
                <img
                    src="{% if story.author.profile.image %}
                            {{ story.author.profile.image.url }}
                        {% else %}
                            {% static 'images/default_profile.png' %}
                        {% endif %}"
                >
                <span>{{ story.author.username }}</span>
            </a>
        {% empty %}
            <p class="no-story">ìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
    </div>

    {% for post in posts %}
    <div class="post-card">
        <!-- ì‘ì„±ì ì´ë¯¸ì§€, ì´ë¦„ -->
        <div class="post-header">
            <img class="post-profile-image"
                src="{% if post.author.profile.image %}{{ post.author.profile.image.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}"
                alt="profile"
            >
            <a href="{% url 'users:profile' post.author.username %}">
                {{ post.author.username }}
            </a>
        </div>

        <!-- í´ë¦­ ì‹œ detail í˜ì´ì§€ ì´ë™ -->
        <a href="{% url 'posts:detail' post.pk %}">    
            <!-- ì´ë¯¸ì§€ -->
            {% if post.image %}
            <div class="post-image">
                <img src="{{ post.image.url }}" alt="post image">
            </div>
            {% endif %}
            
            <!-- ë‚´ìš© -->
            {% if post.content %}
            <div class="post-content">
                {{ post.content }}
            </div>
            {% endif %}
        </a>

        <!-- ì¢‹ì•„ìš” -->
        <div class="post-actions">
            <form action="{% url 'posts:like' post.pk %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="like-btn">
                    {% if post.pk in liked_post_ids %}
                        â¤ï¸
                    {% else %}
                        ğŸ¤
                    {% endif %}
                    {{ post.likes.count }}
                </button>
            </form>

        </div>
        <!-- ë‚ ì§œ -->
        <div class="post-date">
            {{ post.created_at|date:"Y.m.d H:i" }}
        </div>
    </div>

    {% empty %}
        <p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}

</div>
{% endblock %}