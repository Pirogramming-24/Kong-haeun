{% extends "base.html" %}
{% block content %}

<h1>나의 영화 컬렉션</h1>

<p>
  전체 {{ total_count }}편 |
  TMDB {{ tmdb_count }}편 |
  직접 추가 {{ custom_count }}편
</p>

<!-- 검색 + 필터 + 정렬 -->
<form method="get" style="margin-bottom:20px;">

  <!-- 검색 -->
  <input
    type="text"
    name="q"
    placeholder="영화 제목 / 감독 / 배우 검색"
    value="{{ query }}"
  />
  <button type="submit">검색</button>

  <!-- 필터 -->
  <div style="margin-top:10px;">
    <strong>필터:</strong>
    <button type="submit" name="filter" value="all">전체</button>
    <button type="submit" name="filter" value="tmdb">TMDB</button>
    <button type="submit" name="filter" value="custom">직접추가</button>
  </div>

  <!-- 정렬 -->
  <div style="margin-top:10px;">
    <strong>정렬:</strong>
    <button type="submit" name="sort" value="latest">최신순</button>
    <button type="submit" name="sort" value="title">제목순</button>
    <button type="submit" name="sort" value="year">개봉년도</button>
  </div>

</form>

<hr>

<!-- 영화 카드 목록 -->
<div style="display:flex; flex-wrap:wrap; gap:20px;">

  {% for movie in movies %}
    <div style="width:180px; text-align:center;">
      <a href="{% url 'reviews:movie_detail' movie.id %}">
        
        {% if movie.poster_image %}
          <img src="{{ movie.poster_image.url }}" style="width:100%;">
        {% elif movie.poster_path %}
          <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" style="width:100%;">
        {% else %}
          <div style="width:100%; height:260px; background:#eee; line-height:260px;">
            No Image
          </div>
        {% endif %}

        <p><strong>{{ movie.title }}</strong></p>
      </a>

      {% if movie.is_from_tmdb %}
        <small>TMDB</small>
      {% else %}
        <small>직접 추가</small>
      {% endif %}
    </div>
  {% empty %}
    <p>조건에 맞는 영화가 없습니다.</p>
  {% endfor %}

</div>

<div style="margin-top:20px;">
  {% if movies.has_previous %}
    <a href="?page={{ movies.previous_page_number }}">이전</a>
  {% endif %}

  <span>
    {{ movies.number }} / {{ movies.paginator.num_pages }}
  </span>

  {% if movies.has_next %}
    <a href="?page={{ movies.next_page_number }}">다음</a>
  {% endif %}
</div>

{% endblock %}
